<!DOCTYPE html>

<html>
<head>

<script>

window.onload = function () {
  var searchArgs = location.href.match("[^?]+\\?([^=]+=[^&]*&?)+");

  if (searchArgs && (searchArgs.length > 1)) {
    for (var i = 1; i < searchArgs.length; i++) {
      var codeArg = searchArgs[i].match("code=(.*)");
      if(codeArg && (codeArg.length > 1)) {
        var authCode = codeArg[1];
        
        //alert("authCode\n" + authCode);
        
        if(inIframe()) {
          parent.postMessage(authCode, "*");
        }
        else if(inTab()) {
          window.opener.postMessage(authCode, "*");
          window.close();
        }
      }
    }
  }
}

function inIframe () {
    try {
        return window.self !== window.top;
    } catch (e) {
        return true;
    }
}

function inTab () {
  try {
    return window.self !== window.opener;
  }
  catch (e) {
    return false;
  }
}

</script>

</head>
<body></body>
</html>
